---
id: "VUL-2024-001"
title: "SQL注入漏洞示例"
status: "unresolved"
level: "IV"
discoveredAt: "2024-01-15"
category: "Web安全"
description: "用户输入未经过滤直接拼接到SQL查询中"
tags: ["SQL注入", "数据库安全", "Web应用"]
---

# SQL注入漏洞详细分析

## 漏洞描述

在用户登录功能中发现SQL注入漏洞，攻击者可以通过构造恶意输入绕过身份验证。

## 漏洞位置

文件：`/api/auth/login.php`
行号：第42行

## 漏洞代码

\`\`\`php
$query = "SELECT * FROM users WHERE username = '" . $_POST['username'] . "' AND password = '" . md5($_POST['password']) . "'";
$result = mysql_query($query);
\`\`\`

## 攻击向量

攻击者可以在用户名字段输入以下payload：

\`\`\`sql
admin' OR '1'='1' --
\`\`\`

这将导致SQL查询变为：

\`\`\`sql
SELECT * FROM users WHERE username = 'admin' OR '1'='1' --' AND password = 'xxx'
\`\`\`

## 影响评估

- **机密性**：高 - 可能泄露用户数据
- **完整性**：高 - 可能修改数据库内容  
- **可用性**：中 - 可能导致服务中断

## 修复建议

1. 使用参数化查询（预处理语句）
2. 对用户输入进行严格验证和过滤
3. 实施最小权限原则

### 修复代码示例

\`\`\`php
$stmt = $pdo->prepare("SELECT * FROM users WHERE username = ? AND password = ?");
$stmt->execute([$username, md5($password)]);
$result = $stmt->fetch();
\`\`\`

## 数学公式示例

风险评分计算公式：

$$Risk = \frac{Threat \times Vulnerability \times Impact}{Controls}$$

其中：
- $Threat$ = 威胁等级 (1-5)
- $Vulnerability$ = 漏洞严重程度 (1-5)  
- $Impact$ = 影响程度 (1-5)
- $Controls$ = 现有控制措施效果 (1-5)

## 时间线

- **2024-01-15**: 漏洞发现
- **2024-01-16**: 初步分析完成
- **2024-01-17**: 影响评估完成
- **待定**: 修复计划制定

## 参考资料

- [OWASP SQL Injection Prevention Cheat Sheet](https://owasp.org/www-community/attacks/SQL_Injection)
- [CWE-89: Improper Neutralization of Special Elements used in an SQL Command](https://cwe.mitre.org/data/definitions/89.html)
